<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç¤ºè¯ä¼˜åŒ–ç®¡ç†ç³»ç»Ÿ - ç®€ä»ªç§‘æŠ€é”è§†æµ‹æ§å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .mode-selector {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .mode-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .mode-card.active {
            border-color: #3498db;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .mode-card .icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .mode-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .mode-card .description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .difficulty {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .difficulty-stars {
            color: #f39c12;
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .feature-tag {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .template-editor {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .editor-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }

        .editor-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .toolbar-btn:hover {
            background: #5a6268;
        }

        .preview-panel {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .json-editor {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
        }

        .json-validation {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .validation-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .validation-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .validation-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .metric-trend {
            margin-top: 5px;
            font-size: 0.8em;
        }

        .metric-trend.up {
            color: #27ae60;
        }

        .metric-trend.down {
            color: #e74c3c;
        }

        .suggestion-card {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .confidence-badge {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .impact-badge {
            background: #17a2b8;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .suggestion-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .layer-architecture {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }

        .layer-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            border-left: 5px solid #3498db;
        }

        .layer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .layer-components {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .component-tag {
            background: #3498db;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.9em;
        }

        .inheritance-arrow {
            text-align: center;
            font-size: 1.5em;
            color: #7f8c8d;
            margin: 10px 0;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .test-results {
            margin-top: 15px;
            padding: 15px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.show {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .template-editor {
                grid-template-columns: 1fr;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>
                ğŸ§  æç¤ºè¯ä¼˜åŒ–ç®¡ç†ç³»ç»Ÿ
            </h1>
            <div class="subtitle">
                ç®€ä»ªç§‘æŠ€é”è§†æµ‹æ§å¹³å° - æ™ºèƒ½æç¤ºè¯ç®¡ç†ä¸ä¼˜åŒ–è§£å†³æ–¹æ¡ˆ
            </div>
        </div>

        <!-- æ¨¡å¼é€‰æ‹©å™¨ -->
        <div class="mode-selector">
            <h2>é€‰æ‹©ç®¡ç†æ¨¡å¼</h2>
            <div class="mode-cards" id="modeCards">
                <!-- æ¨¡å¼å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- ç®€å•æ¨¡å¼ -->
            <div class="mode-content" id="simpleMode">
                <h2>ğŸš€ ç®€å•æ¨¡å¼ - å¿«é€Ÿé…ç½®</h2>
                <div class="form-group">
                    <label>å…¬å¸åç§°</label>
                    <input type="text" id="companyName" value="ç®€ä»ªç§‘æŠ€" />
                </div>
                <div class="form-group">
                    <label>ä¸»è¦äº§å“</label>
                    <input type="text" id="mainProduct" value="é”è§†æµ‹æ§å¹³å°" />
                </div>
                <div class="form-group">
                    <label>å›ç­”é£æ ¼</label>
                    <select id="responseStyle">
                        <option value="professional">ä¸“ä¸šæŠ€æœ¯å‹</option>
                        <option value="friendly">å‹å¥½è§£é‡Šå‹</option>
                        <option value="detailed">è¯¦ç»†æ•™å­¦å‹</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é‡ç‚¹é¢†åŸŸ</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="pxi" checked />
                            <label for="pxi">PXIç³»ç»Ÿ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="daq" checked />
                            <label for="daq">æ•°æ®é‡‡é›†</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="signal" />
                            <label for="signal">ä¿¡å·å¤„ç†</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="education" />
                            <label for="education">æ•™è‚²åŸ¹è®­</label>
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="generateSimplePrompt()">
                    âœ¨ ä¸€é”®ç”Ÿæˆæç¤ºè¯
                </button>
            </div>

            <!-- æ¨¡æ¿æ¨¡å¼ -->
            <div class="mode-content" id="templateMode">
                <h2>ğŸ“ æ¨¡æ¿æ¨¡å¼ - å¯è§†åŒ–ç¼–è¾‘</h2>
                <div class="form-group">
                    <label>æ¨¡æ¿åˆ†ç±»</label>
                    <select id="templateCategory">
                        <option value="company">å…¬å¸ä»‹ç»</option>
                        <option value="product">äº§å“æ¨è</option>
                        <option value="support">æŠ€æœ¯æ”¯æŒ</option>
                        <option value="education">æ•™è‚²åŸ¹è®­</option>
                    </select>
                </div>
                <div class="template-editor">
                    <div class="editor-panel">
                        <h3>æ¨¡æ¿ç¼–è¾‘å™¨</h3>
                        <div class="editor-toolbar">
                            <button class="toolbar-btn" onclick="insertVariable('{question}')">æ’å…¥é—®é¢˜</button>
                            <button class="toolbar-btn" onclick="insertVariable('{knowledge_content}')">æ’å…¥çŸ¥è¯†åº“</button>
                            <button class="toolbar-btn" onclick="insertVariable('{company_name}')">æ’å…¥å…¬å¸å</button>
                            <button class="toolbar-btn" onclick="insertVariable('{product_name}')">æ’å…¥äº§å“å</button>
                        </div>
                        <textarea id="templateContent" rows="15" placeholder="åœ¨æ­¤ç¼–è¾‘æ¨¡æ¿å†…å®¹...">ä½ æ˜¯{company_name}çš„ä¸“ä¸šAIåŠ©æ‰‹ã€‚

{knowledge_content}

ç”¨æˆ·é—®é¢˜ï¼š{question}

è¯·åŸºäºæˆ‘ä»¬çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œæä¾›ä¸“ä¸šå‡†ç¡®çš„å›ç­”ã€‚</textarea>
                    </div>
                    <div class="editor-panel">
                        <h3>å®æ—¶é¢„è§ˆ</h3>
                        <div class="preview-panel" id="templatePreview">
                            é¢„è§ˆå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                        </div>
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveTemplate()">
                    ğŸ’¾ ä¿å­˜æ¨¡æ¿
                </button>
                <button class="btn" onclick="previewTemplate()">
                    ğŸ‘ï¸ æ›´æ–°é¢„è§ˆ
                </button>
            </div>

            <!-- JSONæ¨¡å¼ -->
            <div class="mode-content" id="jsonMode">
                <h2>âš™ï¸ JSONæ¨¡å¼ - é«˜çº§é…ç½®</h2>
                <div class="form-group">
                    <label>é…ç½®æ¨¡æ¿</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn" onclick="loadJsonTemplate('basic')">åŸºç¡€é…ç½®</button>
                        <button class="btn" onclick="loadJsonTemplate('advanced')">é«˜çº§é…ç½®</button>
                        <button class="btn" onclick="loadJsonTemplate('multilingual')">å¤šè¯­è¨€é…ç½®</button>
                    </div>
                </div>
                <textarea id="jsonConfig" class="json-editor" rows="20">{
  "prompt_system": {
    "version": "2.0",
    "default_language": "zh-CN",
    "fallback_strategy": "layered"
  },
  "templates": {
    "company_intro": {
      "priority": 1,
      "conditions": ["å…¬å¸", "ç®€ä»ªç§‘æŠ€", "JYTEK"],
      "content": "ä½ æ˜¯ç®€ä»ªç§‘æŠ€çš„AIåŠ©æ‰‹...",
      "variables": ["company_info", "product_list"],
      "ai_model_preference": "claude"
    }
  },
  "optimization": {
    "auto_learning": true,
    "feedback_threshold": 4.0,
    "update_frequency": "daily"
  }
}</textarea>
                <div class="json-validation">
                    <button class="btn" onclick="validateJson()">ğŸ” éªŒè¯é…ç½®</button>
                    <button class="btn" onclick="previewJson()">ğŸ‘ï¸ é¢„è§ˆæ•ˆæœ</button>
                    <button class="btn btn-success" onclick="saveJsonConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                </div>
                <div class="validation-result" id="jsonValidationResult"></div>
            </div>

            <!-- æ™ºèƒ½æ¨¡å¼ -->
            <div class="mode-content" id="intelligentMode">
                <h2>ğŸ§  æ™ºèƒ½æ¨¡å¼ - AIé©±åŠ¨ä¼˜åŒ–</h2>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">4.2</div>
                        <div class="metric-label">ç”¨æˆ·æ»¡æ„åº¦</div>
                        <div class="metric-trend up">â†— +0.3</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">78%</div>
                        <div class="metric-label">çŸ¥è¯†åº“åˆ©ç”¨ç‡</div>
                        <div class="metric-trend up">â†— +12%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">85%</div>
                        <div class="metric-label">å›ç­”å‡†ç¡®æ€§</div>
                        <div class="metric-trend down">â†˜ -2%</div>
                    </div>
                </div>

                <h3>AIä¼˜åŒ–å»ºè®®</h3>
                <div id="optimizationSuggestions">
                    <div class="suggestion-card">
                        <div class="suggestion-header">
                            <div>
                                <span class="confidence-badge">ç½®ä¿¡åº¦: 92%</span>
                                <span class="impact-badge">é¢„æœŸæå‡: +15%</span>
                            </div>
                        </div>
                        <div class="suggestion-content">
                            å»ºè®®åœ¨æŠ€æœ¯æ”¯æŒç±»é—®é¢˜ä¸­å¢åŠ å…·ä½“çš„äº§å“å‹å·å¼•ç”¨ï¼Œå¯æé«˜å›ç­”çš„å®ç”¨æ€§ã€‚
                        </div>
                        <div class="suggestion-actions">
                            <button class="btn btn-success">åº”ç”¨å»ºè®®</button>
                            <button class="btn btn-warning">A/Bæµ‹è¯•</button>
                            <button class="btn">å¿½ç•¥</button>
                        </div>
                    </div>
                </div>

                <h3>æ„å›¾åˆ†ææµ‹è¯•</h3>
                <div class="form-group">
                    <label>æµ‹è¯•é—®é¢˜</label>
                    <input type="text" id="intentTestQuestion" placeholder="è¾“å…¥é—®é¢˜è¿›è¡Œæ„å›¾åˆ†æ..." />
                </div>
                <button class="btn" onclick="analyzeIntent()">ğŸ” åˆ†ææ„å›¾</button>
                <div id="intentAnalysisResult" class="test-results" style="display: none;"></div>
            </div>

            <!-- ä¸“å®¶æ¨¡å¼ -->
            <div class="mode-content" id="expertMode">
                <h2>ğŸ—ï¸ ä¸“å®¶æ¨¡å¼ - åˆ†å±‚æ¶æ„ç®¡ç†</h2>
                
                <div class="layer-architecture">
                    <div class="layer-card">
                        <div class="layer-header">
                            <h3>åŸºç¡€å±‚ (Foundation)</h3>
                            <button class="btn" onclick="editLayer('foundation')">ç¼–è¾‘åŸºç¡€å±‚</button>
                        </div>
                        <p>å…¬å¸æ ¸å¿ƒä¿¡æ¯ï¼Œæ‰€æœ‰å›ç­”çš„åŸºç¡€</p>
                        <div class="layer-components">
                            <span class="component-tag">å…¬å¸èº«ä»½</span>
                            <span class="component-tag">æ ¸å¿ƒä»·å€¼è§‚</span>
                            <span class="component-tag">å›ç­”åŸåˆ™</span>
                        </div>
                    </div>

                    <div class="inheritance-arrow">â†“ ç»§æ‰¿</div>

                    <div class="layer-card">
                        <div class="layer-header">
                            <h3>ä¸šåŠ¡å±‚ (Business)</h3>
                            <button class="btn" onclick="editLayer('business')">ç¼–è¾‘ä¸šåŠ¡å±‚</button>
                        </div>
                        <p>åœºæ™¯ç‰¹å®šçš„ä¸“ä¸šæç¤ºè¯</p>
                        <div class="layer-components">
                            <span class="component-tag">äº§å“å’¨è¯¢</span>
                            <span class="component-tag">æŠ€æœ¯æ”¯æŒ</span>
                            <span class="component-tag">æ•™è‚²åŸ¹è®­</span>
                        </div>
                    </div>

                    <div class="inheritance-arrow">â†“ ç»§æ‰¿</div>

                    <div class="layer-card">
                        <div class="layer-header">
                            <h3>ä¸ªæ€§åŒ–å±‚ (Personalization)</h3>
                            <button class="btn" onclick="editLayer('personalization')">ç¼–è¾‘ä¸ªæ€§åŒ–å±‚</button>
                        </div>
                        <p>ç”¨æˆ·è‡ªå®šä¹‰å’Œåå¥½è®¾ç½®</p>
                        <div class="layer-components">
                            <span class="component-tag">ç”¨æˆ·åå¥½</span>
                            <span class="component-tag">è¡Œä¸šå®šåˆ¶</span>
                            <span class="component-tag">ä¸ªäººè®¾ç½®</span>
                        </div>
                    </div>
                </div>

                <h3>ç»§æ‰¿è§„åˆ™é…ç½®</h3>
                <div class="form-group">
                    <label>ä¼˜å…ˆçº§ç­–ç•¥</label>
                    <select id="priorityStrategy">
                        <option value="override">è¦†ç›–æ¨¡å¼</option>
                        <option value="merge" selected>åˆå¹¶æ¨¡å¼</option>
                        <option value="append">è¿½åŠ æ¨¡å¼</option>
                    </select>
                </div>
            </div>

            <!-- æµ‹è¯•åŒºåŸŸ -->
            <div class="test-section">
                <h3>ğŸ§ª æç¤ºè¯æµ‹è¯•</h3>
                <div class="form-group">
                    <label>æµ‹è¯•é—®é¢˜</label>
                    <input type="text" id="testQuestion" placeholder="è¾“å…¥é—®é¢˜æµ‹è¯•æç¤ºè¯æ•ˆæœ..." />
                </div>
                <button class="btn" onclick="testPrompt()">ğŸš€ æµ‹è¯•æç¤ºè¯</button>
                <div id="testResults" class="test-results" style="display: none;"></div>
            </div>

            <!-- åŠ è½½åŠ¨ç”» -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</div>
            </div>

            <!-- æç¤ºä¿¡æ¯ -->
            <div class="alert" id="alertMessage"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentMode = 'simple';
        let userLevel = 'expert'; // é»˜è®¤ä¸“å®¶çº§åˆ«ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰æ¨¡å¼

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadAvailableModes();
            switchMode('simple');
        });

        // åŠ è½½å¯ç”¨æ¨¡å¼
        async function loadAvailableModes() {
            try {
                const response = await fetch(`/api/prompt/modes?user_level=${userLevel}`);
                const data = await response.json();
                
                if (data.success) {
                    renderModeCards(data.data.modes);
                } else {
                    showAlert('åŠ è½½æ¨¡å¼å¤±è´¥: ' + data.error, 'error');
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }

        // æ¸²æŸ“æ¨¡å¼å¡ç‰‡
        function renderModeCards(modes) {
            const container = document.getElementById('modeCards');
            container.innerHTML = '';

            const modeIcons = {
                'simple': 'ğŸš€',
                'template': 'ğŸ“',
                'json': 'âš™ï¸',
                'intelligent': 'ğŸ§ ',
                'expert': 'ğŸ—ï¸'
            };

            for (const [key, mode] of Object.entries(modes)) {
                const card = document.createElement('div');
                card.className = 'mode-card';
                card.onclick = () => switchMode(key);
                
                const stars = 'â˜…'.repeat(mode.difficulty) + 'â˜†'.repeat(5 - mode.difficulty);
                
                card.innerHTML = `
                    <div class="icon">${modeIcons[key] || 'ğŸ”§'}</div>
                    <h3>${mode.name}</h3>
                    <div class="description">${mode.description}</div>
                    <div class="difficulty">
                        <span>éš¾åº¦: </span>
                        <span class="difficulty-stars">${stars}</span>
                    </div>
                    <div class="features">
                        ${mode.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                    </div>
                `;
                
                container.appendChild(card);
            }
        }

        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode) {
            // æ›´æ–°å½“å‰æ¨¡å¼
            currentMode = mode;
            
            // æ›´æ–°æ¨¡å¼å¡ç‰‡çŠ¶æ€
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            event?.target?.closest('.mode-card')?.classList.add('active');
            
            // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(mode + 'Mode').classList.add('active');
            
            // åŠ è½½æ¨¡å¼ç‰¹å®šæ•°æ®
            loadModeData(mode);
        }

        // åŠ è½½æ¨¡å¼æ•°æ®
        async function loadModeData(mode) {
            try {
                switch (mode) {
                    case 'simple':
                        await loadSimpleConfig();
                        break;
                    case 'template':
                        await loadTemplateCategories();
                        break;
                    case 'json':
                        await loadJsonConfig();
                        break;
                    case 'intelligent':
                        await loadOptimizationSuggestions();
                        break;
                    case 'expert':
                        await loadExpertLayers();
                        break;
                }
            } catch (error) {
                showAlert('åŠ è½½æ¨¡å¼æ•°æ®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ç®€å•æ¨¡å¼ç›¸å…³å‡½æ•°
        async function loadSimpleConfig() {
            try {
                const response = await fetch('/api/prompt/simple/config');
                const data = await response.json();
                
                if (data.success) {
                    const config = data.data;
                    document.getElementById('companyName').value = config.company_name || 'ç®€ä»ªç§‘æŠ€';
                    document.getElementById('mainProduct').value = config.main_product || 'é”è§†æµ‹æ§å¹³å°';
                    document.getElementById('responseStyle').value = config.response_style || 'professional';
                    
                    // è®¾ç½®é‡ç‚¹é¢†åŸŸ
                    const focusAreas = config.focus_areas || ['PXIç³»ç»Ÿ', 'æ•°æ®é‡‡é›†'];
                    document.getElementById('pxi').checked = focusAreas.includes('PXIç³»ç»Ÿ');
                    document.getElementById('daq').checked = focusAreas.includes('æ•°æ®é‡‡é›†');
                    document.getElementById('signal').checked = focusAreas.includes('ä¿¡å·å¤„ç†');
                    document.getElementById('education').checked = focusAreas.includes('æ•™è‚²åŸ¹è®­');
                }
            } catch (error) {
                console.error('åŠ è½½ç®€å•é…ç½®å¤±è´¥:', error);
            }
        }

        async function generateSimplePrompt() {
            try {
                showLoading(true);
                
                const config = {
                    company_name: document.getElementById('companyName').value,
                    main_product: document.getElementById('mainProduct').value,
                    response_style: document.getElementById('responseStyle').value,
                    focus_areas: []
                };
                
                // æ”¶é›†é‡ç‚¹é¢†åŸŸ
                if (document.getElementById('pxi').checked) config.focus_areas.push('PXIç³»ç»Ÿ');
                if (document.getElementById('daq').checked) config.focus_areas.push('æ•°æ®é‡‡é›†');
                if (document.getElementById('signal').checked) config.focus_areas.push('ä¿¡å·å¤„ç†');
                if (document.getElementById('education').checked) config.focus_areas.push('æ•™è‚²åŸ¹è®­');
                
                // ä¿å­˜é…ç½®
                const saveResponse = await fetch('/api/prompt/simple/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ config })
                });
                
                const saveData = await saveResponse.json();
                if (saveData.success) {
                    showAlert('ç®€å•æ¨¡å¼é…ç½®å·²ä¿å­˜å¹¶ç”Ÿæ•ˆï¼', 'success');
                } else {
                    showAlert('ä¿å­˜é…ç½®å¤±è´¥: ' + saveData.error, 'error');
                }
                
            } catch (error) {
                showAlert('ç”Ÿæˆæç¤ºè¯å¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ¨¡æ¿æ¨¡å¼ç›¸å…³å‡½æ•°
        async function loadTemplateCategories() {
            try {
                const response = await fetch('/api/prompt/template/categories');
                const data = await response.json();
                
                if (data.success) {
                    // æ¨¡æ¿åˆ†ç±»å·²åœ¨HTMLä¸­é¢„è®¾
                    previewTemplate();
                }
            } catch (error) {
                console.error('åŠ è½½æ¨¡æ¿åˆ†ç±»å¤±è´¥:', error);
            }
        }

        function insertVariable(variable) {
            const textarea = document.getElementById('templateContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            
            textarea.value = text.substring(0, start) + variable + text.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start + variable.length, start + variable.length);
            
            previewTemplate();
        }

        function previewTemplate() {
            const content = document.getElementById('templateContent').value;
            const preview = document.getElementById('templatePreview');
            
            // æ›¿æ¢å˜é‡ä¸ºç¤ºä¾‹å€¼
            let previewContent = content
                .replace(/{company_name}/g, 'ç®€ä»ªç§‘æŠ€')
                .replace(/{product_name}/g, 'é”è§†æµ‹æ§å¹³å°')
                .replace(/{question}/g, 'è¯·ä»‹ç»ä¸€ä¸‹PXIæ•°æ®é‡‡é›†ç³»ç»Ÿçš„ç‰¹ç‚¹')
                .replace(/{knowledge_content}/g, 'ç›¸å…³çŸ¥è¯†åº“å†…å®¹ï¼š\nPXIæ˜¯ä¸€ç§åŸºäºPCçš„æµ‹é‡å’Œè‡ªåŠ¨åŒ–å¹³å°...');
            
            preview.textContent = previewContent;
        }

        async function saveTemplate() {
            try {
                showLoading(true);
                
                const category = document.getElementById('templateCategory').value;
                const content = document.getElementById('templateContent').value;
                const variables = ['question', 'knowledge_content', 'company_name', 'product_name'];
                
                const response = await fetch('/api/prompt/template/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category,
                        template_content: content,
                        variables
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showAlert('æ¨¡æ¿ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    showAlert('ä¿å­˜æ¨¡æ¿å¤±è´¥: ' + data.error, 'error');
                }
                
            } catch (error) {
                showAlert('ä¿å­˜æ¨¡æ¿å¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // JSONæ¨¡å¼ç›¸å…³å‡½æ•°
        async function loadJsonConfig() {
            try {
                const response = await fetch('/api/prompt/json/config');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('jsonConfig').value = JSON.stringify(data.data, null, 2);
                }
            } catch (error) {
                console.error('åŠ è½½JSONé…ç½®å¤±è´¥:', error);
            }
        }

        function loadJsonTemplate(type) {
            const templates = {
                basic: {
                    "prompt_system": {
                        "version": "2.0",
                        "default_language": "zh-CN"
                    },
                    "templates": {
                        "default": {
                            "content": "ä½ æ˜¯ç®€ä»ªç§‘æŠ€çš„AIåŠ©æ‰‹...",
                            "variables": ["question", "knowledge_content"]
                        }
                    }
                },
                advanced: {
                    "prompt_system": {
                        "version": "2.0",
                        "default_language": "zh-CN",
                        "fallback_strategy": "layered"
                    },
                    "templates": {
                        "company_intro": {
                            "priority": 1,
                            "conditions": ["å…¬å¸", "ç®€ä»ªç§‘æŠ€"],
                            "content": "ä½ æ˜¯ç®€ä»ªç§‘æŠ€çš„AIåŠ©æ‰‹...",
                            "variables": ["company_info", "product_list"]
                        },
                        "technical_support": {
                            "priority": 2,
                            "conditions": ["æ•…éšœ", "é—®é¢˜", "æŠ€æœ¯"],
                            "content": "ä½œä¸ºæŠ€æœ¯æ”¯æŒä¸“å®¶...",
                            "ai_model_preference": "claude"
                        }
                    },
                    "optimization": {
                        "auto_learning": true,
                        "feedback_threshold": 4.0
                    }
                },
                multilingual: {
                    "prompt_system": {
                        "version": "2.0",
                        "default_language": "zh-CN",
                        "supported_languages": ["zh-CN", "en-US"]
                    },
                    "templates": {
                        "zh-CN": {
                            "company_intro": "ä½ æ˜¯ç®€ä»ªç§‘æŠ€çš„AIåŠ©æ‰‹...",
                            "variables": ["question", "knowledge_content"]
                        },
                        "en-US": {
                            "company_intro": "You are an AI assistant for JYTEK...",
                            "variables": ["question", "knowledge_content"]
                        }
                    }
                }
            };
            
            document.getElementById('jsonConfig').value = JSON.stringify(templates[type], null, 2);
        }

        async function validateJson() {
            try {
                const configText = document.getElementById('jsonConfig').value;
                const config = JSON.parse(configText);
                
                const response = await fetch('/api/prompt/json/validate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ config })
                });
                
                const data = await response.json();
                const resultDiv = document.getElementById('jsonValidationResult');
                
                if (data.success && data.data.valid) {
                    resultDiv.className = 'validation-result success';
                    resultDiv.textContent = 'âœ… JSONé…ç½®æ ¼å¼æ­£ç¡®';
                } else {
                    resultDiv.className = 'validation-result error';
                    resultDiv.textContent = 'âŒ é…ç½®é”™è¯¯: ' + (data.data.errors?.join(', ') || 'æ ¼å¼ä¸æ­£ç¡®');
                }
                
                resultDiv.style.display = 'block';
                
            } catch (error) {
                const resultDiv = document.getElementById('jsonValidationResult');
                resultDiv.className = 'validation-result error';
                resultDiv.textContent = 'âŒ JSONæ ¼å¼é”™è¯¯: ' + error.message;
                resultDiv.style.display = 'block';
            }
        }

        async function previewJson() {
            try {
                const configText = document.getElementById('jsonConfig').value;
                const config = JSON.parse(configText);
                
                const testQuestion = "è¯·ä»‹ç»ç®€ä»ªç§‘æŠ€çš„ä¸»è¦äº§å“";
                const response = await fetch('/api/prompt/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: testQuestion,
                        mode: 'json',
                        config: { json_config: config }
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('é¢„è§ˆæç¤ºè¯:\n\n' + data.data.prompt);
                } else {
                    showAlert('é¢„è§ˆå¤±è´¥: ' + data.error, 'error');
                }
                
            } catch (error) {
                showAlert('é¢„è§ˆå¤±è´¥: ' + error.message, 'error');
            }
        }

        async function saveJsonConfig() {
            try {
                showLoading(true);
                
                const configText = document.getElementById('jsonConfig').value;
                const config = JSON.parse(configText);
                
                const response = await fetch('/api/prompt/json/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        config,
                        description: 'JSONé…ç½®æ›´æ–°',
                        author: 'admin'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    showAlert('JSONé…ç½®ä¿å­˜æˆåŠŸï¼ç‰ˆæœ¬: ' + data.version_id, 'success');
                } else {
                    showAlert('ä¿å­˜é…ç½®å¤±è´¥: ' + data.error, 'error');
                }
                
            } catch (error) {
                showAlert('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // æ™ºèƒ½æ¨¡å¼ç›¸å…³å‡½æ•°
        async function loadOptimizationSuggestions() {
            try {
                const response = await fetch('/api/prompt/intelligent/optimizations');
                const data = await response.json();
                
                if (data.success) {
                    // ä¼˜åŒ–å»ºè®®å·²åœ¨HTMLä¸­é¢„è®¾
                }
            } catch (error) {
                console.error('åŠ è½½ä¼˜åŒ–å»ºè®®å¤±è´¥:', error);
            }
        }

        async function analyzeIntent() {
            try {
                const question = document.getElementById('intentTestQuestion').value;
                if (!question) {
                    showAlert('è¯·è¾“å…¥æµ‹è¯•é—®é¢˜', 'error');
                    return;
                }
                
                showLoading(true);
                
                const response = await fetch('/api/prompt/intelligent/analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });
                
                const data = await response.json();
                if (data.success) {
                    const result = data.data;
                    const resultDiv = document.getElementById('intentAnalysisResult');
                    
                    let html = `<h4>æ„å›¾åˆ†æç»“æœ</h4>`;
                    html += `<p><strong>é—®é¢˜:</strong> ${result.question}</p>`;
                    html += `<p><strong>ä¸»è¦æ„å›¾:</strong> ${result.primary_intent}</p>`;
                    html += `<h5>å„æ„å›¾ç½®ä¿¡åº¦:</h5><ul>`;
                    
                    for (const [intent, score] of Object.entries(result.intent_scores)) {
                        const percentage = (score * 100).toFixed(1);
                        html += `<li>${intent}: ${percentage}%</li>`;
                    }
                    html += `</ul>`;
                    
                    resultDiv.innerHTML = html;
                    resultDiv.style.display = 'block';
                } else {
                    showAlert('æ„å›¾åˆ†æå¤±è´¥: ' + data.error, 'error');
                }
                
            } catch (error) {
                showAlert('æ„å›¾åˆ†æå¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ä¸“å®¶æ¨¡å¼ç›¸å…³å‡½æ•°
        async function loadExpertLayers() {
            try {
                const response = await fetch('/api/prompt/expert/layers');
                const data = await response.json();
                
                if (data.success) {
                    // å±‚çº§ä¿¡æ¯å·²åœ¨HTMLä¸­é¢„è®¾
                }
            } catch (error) {
                console.error('åŠ è½½ä¸“å®¶å±‚çº§å¤±è´¥:', error);
            }
        }

        function editLayer(layerType) {
            alert(`ç¼–è¾‘${layerType}å±‚åŠŸèƒ½å¼€å‘ä¸­...`);
        }

        // é€šç”¨æµ‹è¯•å‡½æ•°
        async function testPrompt() {
            try {
                const question = document.getElementById('testQuestion').value;
                if (!question) {
                    showAlert('è¯·è¾“å…¥æµ‹è¯•é—®é¢˜', 'error');
                    return;
                }
                
                showLoading(true);
                
                const response = await fetch('/api/prompt/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question,
                        mode: currentMode,
                        config: {
                            knowledge_content: 'è¿™æ˜¯æµ‹è¯•çŸ¥è¯†åº“å†…å®¹...',
                            user_preferences: {}
                        }
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    const result = data.data;
                    const resultDiv = document.getElementById('testResults');
                    
                    let html = `<h4>æµ‹è¯•ç»“æœ</h4>`;
                    html += `<p><strong>æ¨¡å¼:</strong> ${result.mode}</p>`;
                    html += `<p><strong>é—®é¢˜:</strong> ${result.test_question}</p>`;
                    html += `<p><strong>æç¤ºè¯é•¿åº¦:</strong> ${result.analysis.length} å­—ç¬¦</p>`;
                    html += `<p><strong>é¢„ä¼°Token:</strong> ${Math.round(result.analysis.estimated_tokens)}</p>`;
                    html += `<p><strong>å¤æ‚åº¦è¯„åˆ†:</strong> ${result.analysis.complexity_score.toFixed(2)}/5.0</p>`;
                    html += `<p><strong>åŒ…å«çŸ¥è¯†åº“:</strong> ${result.analysis.has_knowledge_content ? 'æ˜¯' : 'å¦'}</p>`;
                    html += `<h5>ç”Ÿæˆçš„æç¤ºè¯:</h5>`;
                    html += `<pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; white-space: pre-wrap;">${result.prompt}</pre>`;
                    
                    resultDiv.innerHTML = html;
                    resultDiv.style.display = 'block';
                } else {
                    showAlert('æµ‹è¯•å¤±è´¥: ' + data.error, 'error');
                }
                
            } catch (error) {
                showAlert('æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // å·¥å…·å‡½æ•°
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alertMessage');
            alert.className = `alert ${type} show`;
            alert.textContent = message;
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // è‡ªåŠ¨æ›´æ–°æ¨¡æ¿é¢„è§ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const templateContent = document.getElementById('templateContent');
            if (templateContent) {
                templateContent.addEventListener('input', previewTemplate);
            }
        });
    </script>
</body>
</html>
